{{extend 'layout.html'}}

<section>
<div class="span9">
	<div class="chart">
		<div id="map_canvas" style="width: 100%; height: 100%"></div>
	</div>
</div>

<div class="span3">
	<div class="well">
	<h3>{{=T('Free slots')}}</h3>
	<div class="nav">
   		<span class="label label-success">0-30 %</span>
   		<span class="label label-warning">30-80 %</span>
   		<span class="label label-important">80-100 %</span>
   	</div>
	<div style="position: relative">
		<span class="row-fluid" style="position:absolute; z-index: 101;"><h3 class="span12 pie_label">{{=park['freeslots']}}</h3></span>
		<div id="pie_chart"  style="height:230px"></div>
	</div>
	</div>
</div>
</section>

<script type="text/javascript">
	// Map
	var zoom = 15;
	var lon  = {{=park['latitude']}};
	var lat  = {{=park['longitude']}};
	var map = new OpenLayers.Map("map_canvas");
	var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
	var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
	var position       = new OpenLayers.LonLat(lon, lat).transform( fromProjection, toProjection);

	var markers = new OpenLayers.Layer.Markers( "Markers" );
	markers.addMarker(new OpenLayers.Marker(position));

	map.addLayer(new OpenLayers.Layer.OSM());
	map.addLayer(markers);
	map.setCenter(position, zoom );

	// pie chart
	var options = {
		series: {
			pie: { 
				innerRadius: 0.4, 
				show: true,
				stroke: {color: '#E3E3E3'
				},
				label: {
					show: false,
					radius: 0.2,
				},
			},
       	},
		legend: {show: false},		
		/*grid: {
          		hoverable: false,
	            clickable: false,
        },*/
	};
	var placeholder = $("#pie_chart");
	data = [{'data':{{=park['freeslots']}}, 
			'label': '{{=T('Free slots')}}',
			'color': '{{='#468847' if park['freeslots_rate'] <30 else '#F89406' if park['freeslots_rate'] < 80 else '#B94A48'}}',
			}, 
			{'data':{{=park['slots_taken']}}, 
			'label': '{{=T('Fdeeeree slots')}}',
			'color': '#F5F5F5'}]
	var plot = $.plot($(placeholder), data, options);



</script>
